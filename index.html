<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>INCOME ZONE - লোকালস্টোরেজ বেজড সিস্টেম</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Anton&display=swap');
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  body {
    font-family: 'Arial', sans-serif;
    background: #ff0000;
    color: #fff;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
  }
  .container {
    background: white;
    color: black;
    width: 350px;
    border-radius: 20px;
    padding: 20px 30px;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
  }
  h2 {
    font-family: 'Anton', sans-serif;
    color: #ff0000;
    text-align: center;
    margin-bottom: 15px;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
  }
  input[type="text"], input[type="password"], input[type="number"] {
    width: 100%;
    padding: 8px 10px;
    margin-top: 5px;
    border-radius: 8px;
    border: 1.5px solid #ff0000;
    font-size: 15px;
  }
  button {
    margin-top: 20px;
    width: 100%;
    background: #ff0000;
    border: none;
    padding: 12px;
    font-weight: bold;
    color: white;
    font-size: 16px;
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #cc0000;
  }
  .link-btn {
    background: none;
    color: #ff0000;
    border: none;
    cursor: pointer;
    text-decoration: underline;
    margin-top: 10px;
    font-size: 14px;
  }
  .error-msg {
    color: red;
    font-weight: bold;
    margin-top: 10px;
  }
  .success-msg {
    color: green;
    font-weight: bold;
    margin-top: 10px;
  }
  .hidden {
    display: none;
  }
  .welcome {
    text-align: center;
    margin-bottom: 10px;
  }
  .dashboard-info {
    font-size: 14px;
    background: #ffeded;
    color: #900000;
    padding: 12px;
    border-radius: 10px;
    margin-top: 15px;
  }
  .referral-list {
    margin-top: 15px;
    max-height: 120px;
    overflow-y: auto;
    border: 1px solid #ff0000;
    padding: 10px;
    border-radius: 10px;
    background: #fff0f0;
    color: #900000;
  }
</style>
</head>
<body>

<div class="container" id="register-section">
  <h2>নতুন ইউজার রেজিস্ট্রেশন</h2>
  <label>ইউজারনেম:</label>
  <input type="text" id="reg-username" placeholder="ইউজারনেম লিখুন" />
  <label>পাসওয়ার্ড:</label>
  <input type="password" id="reg-password" placeholder="পাসওয়ার্ড লিখুন" />
  <label>রেফারার কোড (ঐচ্ছিক):</label>
  <input type="text" id="reg-referral" placeholder="যদি কেউ রেফার করে থাকে" />
  <button onclick="registerUser()">রেজিস্টার করুন</button>
  <button class="link-btn" onclick="showLogin()">লগইন করুন</button>
  <div id="reg-msg" class="error-msg"></div>
</div>

<div class="container hidden" id="login-section">
  <h2>ইউজার লগইন</h2>
  <label>ইউজারনেম:</label>
  <input type="text" id="login-username" placeholder="ইউজারনেম লিখুন" />
  <label>পাসওয়ার্ড:</label>
  <input type="password" id="login-password" placeholder="পাসওয়ার্ড লিখুন" />
  <button onclick="loginUser()">লগইন করুন</button>
  <button class="link-btn" onclick="showRegister()">নতুন রেজিস্ট্রেশন</button>
  <div id="login-msg" class="error-msg"></div>
</div>

<div class="container hidden" id="activation-section">
  <h2>এক্টিভেশন ফি পরিশোধ করুন</h2>
  <p>এক্টিভেশন ফি: ১০০ টাকা</p>
  <label>ট্রানজেকশন আইডি দিন:</label>
  <input type="text" id="activation-txn" placeholder="ট্রানজেকশন আইডি লিখুন" />
  <button onclick="activateUser()">এক্টিভ করুন</button>
  <button class="link-btn" onclick="logout()">লগআউট</button>
  <div id="activation-msg" class="error-msg"></div>
</div>

<div class="container hidden" id="dashboard-section">
  <h2>স্বাগতম, <span id="dash-username"></span>!</h2>
  <p class="welcome">আপনি সফলভাবে লগইন ও এক্টিভ হয়েছেন।</p>
  <div class="dashboard-info">
    <strong>রেফারেল বোনাস:</strong> <span id="dash-referral-bonus">0</span> টাকা<br>
    <strong>রেফারেল লেভেলস:</strong>
    <ul id="referral-levels">
      <li>লেভেল ১: ৮ টাকা প্রতি রেফার</li>
      <li>লেভেল ২: ৪ টাকা প্রতি রেফার</li>
      <li>লেভেল ৩: ২ টাকা প্রতি রেফার</li>
    </ul>
  </div>
  <h3>তোমার রেফার্ড ইউজাররা:</h3>
  <div class="referral-list" id="referral-list"></div>
  <button onclick="logout()">লগআউট</button>
</div>

<script>
  // লোকালস্টোরেজে ইউজার ডাটাবেস
  // স্ট্রাকচার: users = { username: {password, active, txnId, referral, referrals:[], referralBonus } }
  let users = JSON.parse(localStorage.getItem('users')) || {};

  // বর্তমান লগইন ইউজার
  let currentUser = localStorage.getItem('currentUser') || null;

  function saveUsers() {
    localStorage.setItem('users', JSON.stringify(users));
  }

  // UI section গুলো দেখানো/লুকানো
  function showRegister() {
    clearMessages();
    document.getElementById('register-section').classList.remove('hidden');
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('activation-section').classList.add('hidden');
    document.getElementById('dashboard-section').classList.add('hidden');
  }
  function showLogin() {
    clearMessages();
    document.getElementById('register-section').classList.add('hidden');
    document.getElementById('login-section').classList.remove('hidden');
    document.getElementById('activation-section').classList.add('hidden');
    document.getElementById('dashboard-section').classList.add('hidden');
  }
  function showActivation() {
    clearMessages();
    document.getElementById('register-section').classList.add('hidden');
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('activation-section').classList.remove('hidden');
    document.getElementById('dashboard-section').classList.add('hidden');
  }
  function showDashboard() {
    clearMessages();
    document.getElementById('register-section').classList.add('hidden');
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('activation-section').classList.add('hidden');
    document.getElementById('dashboard-section').classList.remove('hidden');
    loadDashboard();
  }

  function clearMessages() {
    document.getElementById('reg-msg').innerText = '';
    document.getElementById('login-msg').innerText = '';
    document.getElementById('activation-msg').innerText = '';
  }

  // রেজিস্ট্রেশন ফাংশন
  function registerUser() {
    clearMessages();
    let username = document.getElementById('reg-username').value.trim();
    let password = document.getElementById('reg-password').value.trim();
    let referralCode = document.getElementById('reg-referral').value.trim();

    if(username.length
